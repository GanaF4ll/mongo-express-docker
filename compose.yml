services:
  api-gateway:
    build:
      context: .
      dockerfile: docker/api-gateway/Dockerfile
    container_name: api-gateway
    environment:
      - name=value
    volumes:
      - ${PWD}/src/api-gateway:/usr/src/api-gateway 

  user:
    build:
      context: .
      dockerfile: docker/user-service/Dockerfile
    container_name: user
    environment:
      - MONGODB_URI=${MONGODB_USER_DB_URI}
      - PORT=${PORT_USER}
      - JWT_KEY=${JWT_KEY}
    volumes:
      - ${PWD}/src/user-service:/usr/src/user-service 
    depends_on:
      - user-db

  auth:
    build:
      context: .
      dockerfile: docker/auth-service/Dockerfile
    container_name: auth
    environment:
      - PORT=${PORT_AUTH}
      - JWT_KEY=${JWT_KEY}
    volumes:
      - ${PWD}/src/auth-service:/usr/src/auth-service 

  timer:
    build:
      context: .
      dockerfile: docker/timer-service/Dockerfile
    container_name: timer
    environment:
      - MONGODB_URI=${MONGODB_TIMER_DB_URI}
      - PORT=${PORT_TIMER}
    volumes:
      - ./src/timer-service:/usr/src/timer-service  
    depends_on:
      - timer-db


  user-db:
    image: mongo:4.4
    container_name: user-db
    environment:
      - MONGO_INITDB_DATABASE=${USER_DB}
    ports:
      - "27017:27017"

  timer-db:
    image: mongo:4.4
    container_name: timer-db
    environment:
      - MONGO_INITDB_DATABASE=${TIMER_DB}
    ports:
      - "27018:27018"